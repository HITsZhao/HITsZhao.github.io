<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Python-LEGB规则 | _Zhao_</title>
  <meta name="author" content="_Zhao|email:zhao423email@gmail.com">
  
  <meta name="description" content="_Zhao_@Haidian.Beijing|Software Engineer(server)|Python/C/C++/Java">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Python-LEGB规则"/>
  <meta property="og:site_name" content="_Zhao_"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">_Zhao_</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">		
			<h1> Python-LEGB规则</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div class="col-md-9">
	

			

	<!-- content -->
	<div class="mypage">		
	    <hr>
<p>本篇总结了Python中的命名空间及LEGB原则</p>
<hr>
<p><strong>写在前面的话</strong><br>之所以有这篇总结，是因为在当初学习及使用Python的过程中发现，理解Python的LEGB原则是理解Python命名空间的关键，而理解Python的命名空间又是理解Python中许多语法规定的关键。所以，Python的LEGB原则就成为Python中一个非常核心的内容，因而，也就有了本篇。</p>
<p>OK，下面开始正文<br>———————————傲娇的分割线—————————————</p>
<h3 id="1-_命名空间">1. 命名空间</h3>
<p>先来一段概要总结：</p>
<blockquote>
<p>白话一点讲：<strong>命名空间是对变量名的分组划分</strong>。<br>不同组的相同名称的变量视为两个独立的变量，因此隶属于不同分组（即命名空间）的变量名可以重复。<br>命名空间可以存在多个，使用命名空间，表示在该命名空间中查找当前名称。</p>
</blockquote>
<p>虽然命名空间是一个跟具体语言无关的概念，但是，不同的语言由于机制不同，因此在表现上还是有差别的。例如下述Python的例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x = <span class="number">10</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">global</span> x</div><div class="line">    x += <span class="number">1</span></div><div class="line">    <span class="keyword">print</span> x</div></pre></td></tr></table></figure>

<p>在这个例子中，使用函数外部的变量<code>x</code>之前需要使用<code>global</code>关键字。这在<code>C++</code>中是不需要的。<br>所以，在理解Python的命名空间时，不能<code>C++</code>的规则来套，因为语法规则属于机制的实现。<br>那么，如何理解Python的命名空间呢？</p>
<p>在<code>C</code>语言中，存在命名空间的概念，但是并没有提供对命名空间的支持，因此，在编写<code>C</code>程序的过程中，很容易发生<strong>名称碰撞（name collision）</strong>，而避免这一问题，基本靠程序员自身来完成。为了解决这个问题<code>C++</code>中提供了<code>namespace</code>关键字支持。关于这个话题，可以参考<a href="http://www.findfunaax.com/notes/file/134" target="_blank" rel="external">这里</a>。为了不分散话题，就不详细展开了。<br>根据我的经验，理解Python的命名空间，从变量入手是个不错的选择。<br>在<code>C</code>语言中，变量名是内存地址的别名。但是由于<strong>Python一切皆对象</strong>，所以<strong>在Python中变量名是字符串对象</strong>。<br>例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">&gt;&gt;&gt;</span> a = <span class="number">10</span></span></div></pre></td></tr></table></figure>

<p>表示建立<em>字符串对象</em><code>a</code>与<em>Number</em>对象<code>10</code>之间的对应关系。由于这是一种<strong>映射关系</strong>，所以，可以使用<strong>键-值</strong>的形式来表示，即<strong>{name : object}</strong>。<br>前面已经说过，<strong>命名空间是对变量名的分组划分</strong>，所以，Python的命名空间就是对许多<strong>键-值</strong>对的分组划分，即，<strong>键值对的集合</strong>，因此：</p>
<blockquote>
<p>Python的命名空间是一个字典，字典内保存了变量名称与对象之间的映射关系</p>
</blockquote>
<p>好了，到这里，终于可以引入本篇的重点<strong>LEGB</strong>，呼～</p>
<h3 id="2-_LEGB">2. LEGB</h3>
<blockquote>
<p>LEGB含义解释：<br>L-Local(function)；函数内的名字空间<br>E-Enclosing function locals；外部嵌套函数的名字空间(例如closure)<br>G-Global(module)；函数定义所在模块（文件）的名字空间<br>B-Builtin(Python)；Python内置模块的名字空间</p>
</blockquote>
<p>前面讲到，<strong>Python的命名空间是一个字典，字典内保存了变量名称与对象之间的映射关系</strong>，因此，查找变量名就是在命名空间字典中查找<strong>键-值对</strong>。<br>Python有多个命名空间，因此，需要有规则来规定，按照怎样的顺序来查找命名空间，<strong>LEGB就是用来规定命名空间查找顺序的规则</strong>。</p>
<blockquote>
<p>LEGB规定了查找一个名称的顺序为：local—&gt;enclosing function locals—&gt;global—&gt;builtin</p>
</blockquote>
<p>举个栗子来说明：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># encoding: utf-8</span></div><div class="line"></div><div class="line">x = <span class="number">1</span> </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></div><div class="line">    x = <span class="number">2</span> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">innerfoo</span><span class="params">()</span>:</span></div><div class="line">        x = <span class="number">3</span> </div><div class="line">        <span class="keyword">print</span> <span class="string">'locals '</span>, x</div><div class="line">    innerfoo()</div><div class="line">    <span class="keyword">print</span> <span class="string">'enclosing function locals '</span>, x</div><div class="line"></div><div class="line">foo()</div><div class="line"><span class="keyword">print</span> <span class="string">'global '</span>, x</div></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">locals  <span class="number">3</span></div><div class="line">enclosing <span class="function"><span class="keyword">function</span> <span class="title">locals</span>  <span class="title">2</span></span></div><div class="line"><span class="built_in">global</span>  <span class="number">1</span></div></pre></td></tr></table></figure>

<p>对上例稍加改动</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># encoding: utf-8</span></div><div class="line"></div><div class="line">x = <span class="number">1</span> </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></div><div class="line">    x = <span class="number">2</span> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">innerfoo</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment">#    x = 3                  #此处改动：注释掉</span></div><div class="line">        <span class="keyword">print</span> <span class="string">'locals '</span>, x</div><div class="line">    innerfoo()</div><div class="line">    <span class="keyword">print</span> <span class="string">'enclosing function locals '</span>, x</div><div class="line"></div><div class="line">foo()</div><div class="line"><span class="keyword">print</span> <span class="string">'global '</span>, x</div></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">locals  <span class="number">2</span></div><div class="line">enclosing <span class="function"><span class="keyword">function</span> <span class="title">locals</span>  <span class="title">2</span></span></div><div class="line"><span class="built_in">global</span>  <span class="number">1</span></div></pre></td></tr></table></figure>

<p>可以发现：当注释掉<code>x = 3</code>以后，函数<code>innerfoo</code>内部查找到的<code>x</code>是<code>x = 2</code>。</p>
<p>在上述两个例子中，从内到外，依次形成四个命名空间：<br><code>def innerfoo():</code>：Local， 即函数内部命名空间；<br><code>def foo():</code>：Enclosing function locals；外部嵌套函数的名字空间<br><code>module(文件本身)</code>：Global(module)；函数定义所在模块（文件）的名字空间<br><code>Python内置模块的名字空间</code>：Builtin</p>
<p><code>x = 3</code> 属于函数内部命名空间，当被注释掉之后，函数<code>innerfoo</code>内部通过<code>print x</code> 使用<code>x</code>这个名称时，触发了名称查找动作。<br>首先在Local命名空间查找，没有找到，然后到Enclosing function locals命名空间查找，查找成功，然后调用。</p>
<p><strong>写在最后</strong><br>通过上面的分析可以发现，Python在确定一个变量的核心规则是LEGB，只有熟悉LEGB规则，才能清楚在程序执行过程中调用的变量究竟是什么。</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2015/01/31/Python-Unbound-Bound-method-object/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2015/01/27/Python-函数参数匹配/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>

  
</section>

	
	</div> <!-- col-md-9/col-md-12 -->
	
	
		<div class="col-md-3"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	Jan 27 2015 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	

</div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2015 _Zhao|email:zhao423email@gmail.com
  
      with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
   </html>
